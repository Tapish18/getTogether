<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link rel="stylesheet" href="/css/header.css"> -->
    <link rel="stylesheet" href="/css/home.css">
    <title><%= title%></title>

</head>
<body>
    <div class="page-container">

        <%- include("./header.ejs") -%>
        <h1>
            Welcome to my Social Networking Website!!
        </h1>
    
        <% if(locals.user){ %>
            <h4>
                Posts
            </h4>
        
            <section id="feed-news">
                <form action="/posts/createpost" id="post-form" method="post">
                    <textarea name="content" cols="30" rows="3" placeholder="Type Here" required></textarea>
                    <input type="submit" value="Post">
                </form>
            </section>
        <% } %>
    
        <% if(locals.posts){ %>
            <div id="post-container">
                <h2>News Feed</h2>
                <ul>
                    <% for(let post of posts){ %>
                        <li>
                            <%= post.content %>
                            <br>
                            <small>
                                <%= post.user.name%>
                            </small>
                            <br>

                            
                            
                            <% if(locals.user){ %>
                            <% if(locals.user.id == post.user.id) { %>
                                <div class="detete-btn">
                                    <a href="/posts/destroy/<%= post._id%>">Delete Post</a>
                                </div>
                            <% } %>
                            
                            <br>
                            <div class="comment-form">
                                <form action="/comment/create" method="post">
                                    <input type="text" name="content" placeholder="Type Your Comment Here..." required>
                                    <input type="hidden" name="post" value= <%= post._id%>>
                                    <input type="submit" value="Add Comment">
                                </form>
                            </div>
                            <% } %>
                            <br>
                            <ul id="post-comments-<%= post._id %>">
                                <% for(let cmt of post.comment){ %>
                                    <p>
                                        <li>
                                            <%= cmt.content %> &nbsp;
                                            <small>
                                                By : 
                                                <%= cmt.user.name %>
                                            </small>
                                            <% if(locals.user.id == cmt.user.id) { %>
                                                <a href="/comment/destroy/<%= cmt._id%>">Delete Comment</a>
                                            <% } %>
                                            
                                        </li>
                                    </p>
                                    
                                <% } %>
                            </ul>
                            
        
                            
                        </li>
                    <% } %>
                </ul>
            </div>
        <%} %>
    </div>


    <%- include("./footer.ejs") -%>
</body>
</html>